#!/bin/bash
BUILDDIR=~/build
ISOLINUXDIR=$BUILDDIR/isolinux
mkdir -p $ISOLINUXDIR
curl -L -o $BUILDDIR/comps.xml `curl -s http://mirrors.mit.edu/centos/7/os/x86_64/repodata/ | grep -o -P '(<a href=\")\K.*comps.xml(?=\")'`
cp /mnt/repodata/*comps.xml $BUILDDIR/comps.xml
mkdir -p $ISOLINUXDIR/{EXTRAS,images,isolinux,ks,LiveOS,Packages,repodata}
cp /mnt/TRANS.TBL $ISOLINUXDIR
cp /mnt/LiveOS/squashfs.img $ISOLINUXDIR/LiveOS
cp /mnt/isolinux/* $ISOLINUXDIR/isolinux
cp -r /mnt/images/* $ISOLINUXDIR/images
cp /mnt/.discinfo $ISOLINUXDIR/
cp ./ks.cfg $ISOLINUXDIR/ks
cp -f ./isolinux.cfg $ISOLINUXDIR/isolinux

sudo yumdownloader --destdir=$ISOLINUXDIR/Packages --resolve --disablerepo=\* --enablerepo=c7-media --enablerepo=kubernetes --enablerepo=docker-ce-stable --enablerepo=epel --enablerepo=extras acl alsa-firmware alsa-lib alsa-tools-firmware audit audit-libs audit-libs-python authconfig basesystem bash bind-libs-lite bind-license binutils biosdevname bridge-utils btrfs-progs bzip2-libs ca-certificates centos-logos centos-release checkpolicy chkconfig chrony cockpit cockpit-bridge cockpit-kubernetes cockpit-system cockpit-ws container-selinux coreutils cpio cpp cracklib cracklib-dicts cronie cronie-anacron crontabs cryptsetup-libs curl cyrus-sasl-lib dbus dbus-glib dbus-libs dbus-python device-mapper device-mapper-event device-mapper-event-libs device-mapper-libs device-mapper-persistent-data dhclient dhcp-common dhcp-libs diffutils dmidecode dnsmasq docker-ce dpdk-stable dpdk-stable-devel dracut dracut-config-rescue dracut-network e2fsprogs e2fsprogs-libs ebtables elfutils-default-yama-scope elfutils-libelf elfutils-libs epel-release ethtool expat file file-libs filesystem findutils fipscheck fipscheck-lib firewalld firewalld-filesystem fontconfig fontpackages-filesystem freetype fuse fuse-libs fxload gawk gcc gd gdbm GeoIP gettext gettext-libs git glib2 glibc glibc-common glibc-devel glibc-headers glib-networking gmp gnupg2 gnutls gobject-introspection golang golang-bin golang-src gperftools-libs gpgme gpm-libs grep groff-base grub2 grub2-common grub2-pc grub2-pc-modules grub2-tools grub2-tools-extra grub2-tools-minimal grubby gsettings-desktop-schemas gzip hardlink hostname hwdata info initscripts iproute iprutils ipset ipset-libs iptables iputils irqbalance jansson json-glib kbd kbd-legacy kbd-misc kernel kernel-headers kernel-tools kernel-tools-libs kexec-tools keyutils-libs kmod kmod-libs kpartx krb5-libs kubeadm kubectl kubelet kubernetes-cni less libacl libaio libassuan libattr libblkid libcap libcap-ng libcgroup libcom_err libcroco libcurl libdaemon libdb libdb-utils libdnet libdrm libedit libestr libfastjson libffi libgcc libgcrypt libgnome-keyring libgomp libgpg-error libicu libidn libjpeg-turbo libmnl libmodman libmount libmpc libmspack libndp libnetfilter_conntrack libnfnetlink libnl3 libnl3-cli libpcap libpciaccess libpipeline libpng libproxy libpwquality libreport-filesystem libseccomp libselinux libselinux-python libselinux-utils libsemanage libsemanage-python libsepol libss libssh2 libstdc++ libsysfs libtasn1 libteam libtool-ltdl libunistring libunwind libuser libutempter libuuid libverto libX11 libX11-common libXau libxcb libxml2 libXpm libxslt linux-firmware logrotate lsscsi lua lvm2 lvm2-libs lyx-fonts lzo make man-db mdadm microcode_ctl mlocate mozjs17 mpfr mtools ncurses ncurses-base ncurses-libs nettle net-tools NetworkManager NetworkManager-libnm NetworkManager-team NetworkManager-tui NetworkManager-wifi newt newt-python nspr nss nss-pem nss-softokn nss-softokn-freebl nss-sysinit nss-tools nss-util numactl-libs openldap openscap openscap-scanner openssh openssh-clients openssh-server openssl openssl-libs open-vm-tools openvswitch openvswitch-devel os-prober p11-kit p11-kit-trust pam parted passwd pciutils pciutils-libs pcre perl perl-Carp perl-constant perl-Encode perl-Error perl-Exporter perl-File-Path perl-File-Temp perl-Filter perl-Getopt-Long perl-Git perl-HTTP-Tiny perl-libs perl-macros perl-parent perl-PathTools perl-Pod-Escapes perl-podlators perl-Pod-Perldoc perl-Pod-Simple perl-Pod-Usage perl-Scalar-List-Utils perl-Socket perl-Storable perl-TermReadKey perl-Text-ParseWords perl-threads perl-threads-shared perl-Time-HiRes perl-Time-Local pinentry pkgconfig plymouth plymouth-core-libs plymouth-scripts policycoreutils policycoreutils-python polkit polkit-pkla-compat popt procps-ng pth pygpgme pyliblzma python python-configobj python-decorator python-firewall python-gobject-base python-iniparse python-IPy python-libs python-linux-procfs python-perf python-pycurl python-pyudev python-schedutils python-six python-slip python-slip-dbus python-urlgrabber pyxattr qrencode-libs readline rootfiles rpm rpm-build-libs rpm-libs rpm-python rsync rsyslog scap-security-guide sed selinux-policy selinux-policy-targeted setools-libs setup shadow-utils shared-mime-info slang snappy socat sqlite sudo syslinux systemd systemd-libs systemd-sysv sysvinit-tools tar tcp_wrappers-libs teamd trousers tuned tzdata ustr util-linux vim-common vim-enhanced vim-filesystem vim-minimal virt-what wget which wpa_supplicant xfsprogs xml-common xmlsec1 xmlsec1-openssl xz xz-libs yum yum-metadata-parser yum-plugin-fastestmirror zlib


